提升预测模型准确度的系统性建议
基于对你项目的深入分析，当前状态是：

v6 最优：Bull F1=0.454, Bear F1=0.389, Kappa 均 < 0.11
340+ 特征，但链上/情绪/宏观特征全是价格行为代理（模拟的）
单一模型（LightGBM），单一数据源（Binance OHLCV）
Walk-Forward 回测框架已完善
你报告中的结论完全正确：这是信息量瓶颈，不是模型或调参问题。以下按优先级分层建议：

🔴 第一优先级：扩充信息源（最大潜力）
1. 引入真实链上数据
你的 onchain.py 目前全是用价格模拟的代理指标（如 close / close.expanding().mean() 模拟 MVRV），和价格特征高度共线，几乎不提供额外信息。

关键数据源：

指标 数据源 意义
交易所净流入/流出 CryptoQuant / Glassnode API 大户抛售/囤币的直接信号
真实 MVRV Glassnode 全网持有者盈亏状态
稳定币供应量变化 Glassnode / DefiLlama 场外资金进出
活跃地址数 Blockchain.com API (免费) 网络使用热度
矿工持仓变化 CryptoQuant 矿工卖压
真实 FGI Alternative.me API (免费) 市场情绪直读
预期效果：真实链上数据与价格行为的相关性远低于你当前的代理指标，能突破 Kappa 瓶颈。建议先接入免费 API（Alternative.me FGI、Blockchain.com 活跃地址），看到效果后再考虑付费数据。

2. 引入宏观/跨市场因子
BTC 不是孤立资产，与宏观环境高度相关：

因子 获取方式 逻辑
美元指数 (DXY) Yahoo Finance / FRED API DXY↑ → BTC↓
美国 10Y 国债收益率 FRED API (免费) 利率↑ → 风险资产承压
纳斯达克 100 Yahoo Finance 与 BTC 相关性 0.5-0.8
VIX 恐慌指数 Yahoo Finance 系统性风险
黄金价格 Yahoo Finance 避险情绪参照
M2 货币供应量 FRED API 流动性宏观背景
这些数据全部免费可获取，可用 yfinance 包一行代码下载。

3. 引入 BTC 衍生品市场数据
衍生品市场包含大量前瞻信号：

指标 数据源 意义
真实资金费率 (Funding Rate) Binance API (免费) 多空力量对比
未平仓合约量 (Open Interest) Binance/Coinglass 杠杆水平
期权隐含波动率 Deribit API 市场对未来波动的预期
多空比 (Long/Short Ratio) Binance API (免费) 散户情绪
你的 market_structure.py 里的 funding_rate 和 open_interest 是用价格动量和成交量模拟的，与原指标的含义完全不同。

🟡 第二优先级：标签与建模范式改进
4. 改用回归目标 + 分位数决策
当前用硬分类（涨/跌/震荡）丢失了大量信息。建议：

LightGBM 回归模式 + 分位数回归 (objective='quantile') 可以同时估计中位数和置信区间，比硬分类灵活得多。

5. 多时间尺度融合
你目前只用日线单一时间粒度。建议构建多尺度特征：

4 小时线的短期动量特征 → 捕捉日内趋势变化
周线的中期趋势特征 → 过滤噪声
用日线窗口聚合多时间尺度信号
6. 标签工程优化
当前 reversal 标签看窗口内极值，directional 看 T 日后收盘价。可以尝试：

Triple Barrier 标签：设定止盈/止损/超时三重屏障，标签更接近实际交易逻辑（参考 Marcos López de Prado 的《Advances in Financial ML》）
动态阈值：X 不固定为 5%，而是根据近期 ATR 自适应调整（高波动期用更大阈值）
Meta-labeling：先用一个模型预测方向，再用第二个模型预测「这次预测是否可信」
🟢 第三优先级：模型架构升级
7. 模型集成（低成本小收益）
8. 序列模型探索
LightGBM 本质上看不到时间序列的顺序依赖。可以尝试：

Temporal Fusion Transformer (TFT)：专为时序预测设计，自带注意力机制
简单 LSTM + 特征：用你现有的 340+ 特征作为时序输入
但注意：对于日线级别（只有 ~2700 个样本），深度学习容易过拟合
9. 概率校准 + 决策阈值优化
你当前用 predict() 硬分类，但 predict_proba() 包含更多信息：

用 Platt Scaling / Isotonic Regression 校准概率
在 Walk-Forward 中搜索最优决策阈值（不一定是 0.5）
只在高置信度时发信号（如 P > 0.65 才做多），其余时间观望
⚡ 立即可执行的行动计划
步骤 工作量 预期 Kappa 提升
1. 接入 Alternative.me FGI API（免费） 2小时 +0.01~0.03
2. 用 yfinance 引入 DXY/纳指/VIX 2小时 +0.02~0.05
3. 接入 Binance Funding Rate API 3小时 +0.02~0.04
4. 实现 Triple Barrier 标签 4小时 +0.01~0.03
5. 概率阈值优化（不用改模型） 1小时 +0.01~0.02
6. 回归目标 + 分位数决策 3小时 +0.02~0.04
综合预期：如果 1-3 步全部完成，Kappa 有望从 0.05<del>0.10 提升到 **0.15</del>0.25** 范围。超过 0.3 在纯量化（无高频/无内幕）的 BTC 日线预测中已经是非常好的水平。

🧠 关于期望值的诚实说明
你在报告中写到"所有版本 Kappa < 0.11，证实了纯技术面特征对 BTC 短期方向的预测力天然有限"——这是完全正确的诊断。核心原因：

你的 340+ 特征本质上只有 1 个信息源：Binance OHLCV。所有 onchain、sentiment、market_structure 都是价格/成交量的数学变换，不提供独立信息
BTC 价格受宏观政策、监管新闻、鲸鱼操作等非价格因素驱动，纯技术面天花板确实很低
日线级别噪声大，你的周线实验（Kappa=0.138）已经验证了更长周期信噪比更高
建议策略：与其追求"预测准"，不如追求"在高置信度时下注"。即使模型整体 accuracy 只有 55%，如果能识别出 P>0.7 的高置信时刻并只在这些时刻交易，实际盈利能力会远超整体指标所示。

---

## v9 实验结果更新 (2026-02-15)

### 实验结论

| 实验 | Kappa | 结论 |
|------|-------|------|
| v6 基线 | 0.0505/0.0602 | 基线 |
| FGI Only | **0.0624** | ✅ 有效 |
| Macro Only | 0.0533 | ➖ 略降 |
| FR Only | 0.0049 | ❌ 有害 |
| v9 (FGI) | 0.0624/0.0591 | 提升 |

### 关键发现
1. **FGI 单独使用有效** - 真实市场情绪数据能提供独立信息
2. **Funding Rate 有害** - 消融实验证明 FR 特征反而降低预测能力
3. **不要一次性加所有外部数据** - 特征冗余导致性能下降

### 已完成
- ✅ 接入 FGI (Alternative.me API)
- ✅ 验证消融实验方法论
- ✅ 部署 v9 到 Cloud Run
- ✅ v10 FGI特征增强 (失败)
- ✅ v11 directional标签 (失败)
- ✅ v12 T=21窗口 (显著提升!)

---

## v10-v12 实验结果

| 实验 | Bull Kappa | Bear Kappa | 结论 |
|------|------------|------------|------|
| v9 (T=14, FGI) | 0.0624 | 0.0591 | 基线 |
| v10 (增强FGI) | 0.0545 | 0.0518 | ❌ 特征过多过拟合 |
| v11 (directional) | -0.164 | - | ❌ 标签策略不匹配 |
| v12 (T=21, FGI) | **0.0975** | 0.0188 | ⚠️ Bull提升56%, Bear下降 |

### 关键发现

1. **更长预测窗口有效** - T=21 让 Bull Kappa 从 0.06 提升到 0.10
2. **Bull/Bear 不对称** - 同样的改动对两边效果相反
3. **directional 标签失败** - reversal 更适合当前特征

---

## 新实验规划 (v13+)

### 候选实验

| 优先级 | 实验 | 预期效果 | 工作量 |
|--------|------|----------|--------|
| 🔴 1 | FGI 特征增强 | 优化 FGI 衍生特征 | 2h |
| 🔴 2 | 真实链上数据 | MVRV、净流量 | 4h |
| 🟡 3 | 宏观因子 | DXY/VIX/纳指 | 2h |
| 🟡 4 | Triple Barrier 标签 | 更贴合交易逻辑 | 4h |
| 🟢 5 | 概率阈值优化 | 高置信度过滤 | 1h |

### 下一步建议

**实验 A: FGI 特征增强**
- 添加 FGI 动量 (FGI 变化率)
- 添加 FGI 与价格背离
- 尝试不同 FGI 滚动窗口

**实验 B: 回归目标**
- 改用回归预测价格变化率
- 使用分位数决策

**实验 C: 高置信度过滤**
- 只在 P > 0.6 或 P < 0.4 时发信号
- 其余时间观望
