# 实验报告: weekly_bull_v7b_20260213_233341_6e8fb3

**生成时间**: 2026-02-13 23:33:49

## 1. 实验概要

| 项目 | 值 |
|------|------|
| 实验名称 | weekly_bull_v7b |
| 描述 | Bull v7b 对照: 外部数据 + reversal 标签 (隔离外部数据贡献) |
| 标签 | ['weekly', 'bull', 'binary', 'v7b', 'external', 'control'] |
| Git Commit | 41bd739 |
| Git Branch | main |
| 耗时 | Nones |
| 随机种子 | 42 |

## 2. 数据配置

- **数据源**: binance
- **交易对**: BTCUSDT
- **周期**: 1d
- **时间范围**: 2018-01-01 ~ 2025-12-31
- **数据文件**: `data/raw/btc_binance_BTCUSDT_1d.csv`

## 3. 特征配置

- **特征集**: ['technical', 'volume', 'flow', 'market_structure', 'external']
- **总特征数**: 127
- **NaN处理**: ffill_then_drop

## 4. 标签配置

- **策略**: reversal
- **窗口 T**: 14 天
- **阈值 X**: 0.05 (5%)

## 5. 模型配置

- **类型**: lightgbm
- **参数**:
  - n_estimators: 1200
  - max_depth: 5
  - learning_rate: 0.03
  - num_leaves: 24
  - subsample: 0.8
  - colsample_bytree: 0.7
  - min_child_samples: 25
  - reg_alpha: 0.2
  - reg_lambda: 0.2
  - random_state: 42
  - verbose: -1
  - min_split_gain: 0.005
  - auto_scale_pos_weight: True
  - early_stopping_rounds: 50

## 6. 评估结果（汇总）

| 指标               |       值 |
|:-----------------|--------:|
| accuracy         |  0.4528 |
| f1_binary        |  0.563  |
| precision_binary |  0.4517 |
| recall_binary    |  0.7473 |
| f1_macro         |  0.4156 |
| cohen_kappa      | -0.0608 |

## 7. Walk-Forward Fold 详情

- **方法**: walk_forward
- **初始训练集**: 1500
- **OOS窗口**: 63
- **步进**: 21
- **总 Fold 数**: 57

|   fold_id |   train_size |   test_size |   accuracy |   f1_binary |   precision_binary |   recall_binary |   f1_macro |   cohen_kappa |
|----------:|-------------:|------------:|-----------:|------------:|-------------------:|----------------:|-----------:|--------------:|
|    0.0000 |    1500.0000 |     63.0000 |     0.5873 |      0.7400 |             0.5873 |          1.0000 |     0.3700 |        0.0000 |
|    1.0000 |    1521.0000 |     63.0000 |     0.4286 |      0.6000 |             0.4286 |          1.0000 |     0.3000 |        0.0000 |
|    2.0000 |    1542.0000 |     63.0000 |     0.4127 |      0.4478 |             0.3571 |          0.6000 |     0.4103 |       -0.0990 |
|    3.0000 |    1563.0000 |     63.0000 |     0.2063 |      0.3421 |             0.2063 |          1.0000 |     0.1711 |        0.0000 |
|    4.0000 |    1584.0000 |     63.0000 |     0.4921 |      0.6522 |             0.4839 |          1.0000 |     0.3555 |        0.0289 |
|    5.0000 |    1605.0000 |     63.0000 |     0.4762 |      0.6452 |             0.4762 |          1.0000 |     0.3226 |        0.0000 |
|    6.0000 |    1626.0000 |     63.0000 |     0.5556 |      0.7143 |             0.5556 |          1.0000 |     0.3571 |        0.0000 |
|    7.0000 |    1647.0000 |     63.0000 |     0.3492 |      0.2807 |             0.2857 |          0.2759 |     0.3432 |       -0.3132 |
|    8.0000 |    1668.0000 |     63.0000 |     0.3333 |      0.4878 |             0.4348 |          0.5556 |     0.2666 |       -0.4272 |
|    9.0000 |    1689.0000 |     63.0000 |     0.5079 |      0.5507 |             0.5278 |          0.5758 |     0.5034 |        0.0091 |
|   10.0000 |    1710.0000 |     63.0000 |     0.6349 |      0.6102 |             0.4865 |          0.8182 |     0.6334 |        0.3064 |
|   11.0000 |    1731.0000 |     63.0000 |     0.4286 |      0.5000 |             0.3396 |          0.9474 |     0.4167 |        0.1007 |
|   12.0000 |    1752.0000 |     63.0000 |     0.3016 |      0.4634 |             0.3016 |          1.0000 |     0.2317 |        0.0000 |
|   13.0000 |    1773.0000 |     63.0000 |     0.4762 |      0.2326 |             0.1852 |          0.3125 |     0.4175 |       -0.1268 |
|   14.0000 |    1794.0000 |     63.0000 |     0.0952 |      0.1739 |             0.0952 |          1.0000 |     0.0870 |        0.0000 |
|   15.0000 |    1815.0000 |     63.0000 |     0.2063 |      0.3421 |             0.2063 |          1.0000 |     0.1711 |        0.0000 |
|   16.0000 |    1836.0000 |     63.0000 |     0.5873 |      0.0000 |             0.0000 |          0.0000 |     0.3700 |       -0.0315 |
|   17.0000 |    1857.0000 |     63.0000 |     0.3651 |      0.0476 |             0.3333 |          0.0256 |     0.2857 |       -0.0448 |
|   18.0000 |    1878.0000 |     63.0000 |     0.6984 |      0.8224 |             0.6984 |          1.0000 |     0.4112 |        0.0000 |
|   19.0000 |    1899.0000 |     63.0000 |     0.1587 |      0.0702 |             0.2222 |          0.0417 |     0.1510 |       -0.2244 |
|   20.0000 |    1920.0000 |     63.0000 |     0.5714 |      0.7097 |             0.6226 |          0.8250 |     0.4457 |       -0.0506 |
|   21.0000 |    1941.0000 |     63.0000 |     0.4286 |      0.0526 |             0.5000 |          0.0278 |     0.3218 |       -0.0080 |
|   22.0000 |    1962.0000 |     63.0000 |     0.5079 |      0.6737 |             0.5079 |          1.0000 |     0.3368 |        0.0000 |
|   23.0000 |    1983.0000 |     63.0000 |     0.5238 |      0.5161 |             1.0000 |          0.3478 |     0.5237 |        0.2235 |
|   24.0000 |    2004.0000 |     63.0000 |     0.5238 |      0.5946 |             0.8800 |          0.4490 |     0.5088 |        0.1456 |
|   25.0000 |    2025.0000 |     63.0000 |     0.4444 |      0.5455 |             0.7241 |          0.4375 |     0.4156 |       -0.0668 |
|   26.0000 |    2046.0000 |     63.0000 |     0.4762 |      0.6452 |             0.4762 |          1.0000 |     0.3226 |        0.0000 |
|   27.0000 |    2067.0000 |     63.0000 |     0.4762 |      0.6452 |             0.4762 |          1.0000 |     0.3226 |        0.0000 |
|   28.0000 |    2088.0000 |     63.0000 |     0.3651 |      0.5349 |             0.3651 |          1.0000 |     0.2674 |        0.0000 |
|   29.0000 |    2109.0000 |     63.0000 |     0.3175 |      0.4819 |             0.3175 |          1.0000 |     0.2410 |        0.0000 |
|   30.0000 |    2130.0000 |     63.0000 |     0.3016 |      0.4634 |             0.3016 |          1.0000 |     0.2317 |        0.0000 |
|   31.0000 |    2151.0000 |     63.0000 |     0.3175 |      0.4819 |             0.3175 |          1.0000 |     0.2410 |        0.0000 |
|   32.0000 |    2172.0000 |     63.0000 |     0.4762 |      0.0000 |             0.0000 |          0.0000 |     0.3226 |        0.0000 |
|   33.0000 |    2193.0000 |     63.0000 |     0.5238 |      0.6875 |             0.5410 |          0.9429 |     0.3438 |       -0.0630 |
|   34.0000 |    2214.0000 |     63.0000 |     0.3492 |      0.0000 |             0.0000 |          0.0000 |     0.2588 |        0.0000 |
|   35.0000 |    2235.0000 |     63.0000 |     0.7778 |      0.8750 |             0.7778 |          1.0000 |     0.4375 |        0.0000 |
|   36.0000 |    2256.0000 |     63.0000 |     0.7302 |      0.8381 |             0.8000 |          0.8800 |     0.5143 |        0.0395 |
|   37.0000 |    2277.0000 |     63.0000 |     0.8571 |      0.9231 |             0.8571 |          1.0000 |     0.4615 |        0.0000 |
|   38.0000 |    2298.0000 |     63.0000 |     0.6667 |      0.7921 |             0.6897 |          0.9302 |     0.4760 |        0.0378 |
|   39.0000 |    2319.0000 |     63.0000 |     0.5873 |      0.7400 |             0.5873 |          1.0000 |     0.3700 |        0.0000 |
|   40.0000 |    2340.0000 |     63.0000 |     0.3492 |      0.5176 |             0.3492 |          1.0000 |     0.2588 |        0.0000 |
|   41.0000 |    2361.0000 |     63.0000 |     0.2857 |      0.4444 |             0.2857 |          1.0000 |     0.2222 |        0.0000 |
|   42.0000 |    2382.0000 |     63.0000 |     0.1905 |      0.3200 |             0.1905 |          1.0000 |     0.1600 |        0.0000 |
|   43.0000 |    2403.0000 |     63.0000 |     0.3968 |      0.5682 |             0.3968 |          1.0000 |     0.2841 |        0.0000 |
|   44.0000 |    2424.0000 |     63.0000 |     0.6032 |      0.7525 |             0.6032 |          1.0000 |     0.3762 |        0.0000 |
|   45.0000 |    2445.0000 |     63.0000 |     0.6667 |      0.8000 |             0.6667 |          1.0000 |     0.4000 |        0.0000 |
|   46.0000 |    2466.0000 |     63.0000 |     0.5397 |      0.7010 |             0.5397 |          1.0000 |     0.3505 |        0.0000 |
|   47.0000 |    2487.0000 |     63.0000 |     0.4921 |      0.6596 |             0.4921 |          1.0000 |     0.3298 |        0.0000 |
|   48.0000 |    2508.0000 |     63.0000 |     0.3651 |      0.5349 |             0.3651 |          1.0000 |     0.2674 |        0.0000 |
|   49.0000 |    2529.0000 |     63.0000 |     0.3968 |      0.5682 |             0.3968 |          1.0000 |     0.2841 |        0.0000 |
|   50.0000 |    2550.0000 |     63.0000 |     0.6984 |      0.2400 |             0.3750 |          0.1765 |     0.5259 |        0.0814 |
|   51.0000 |    2571.0000 |     63.0000 |     0.4444 |      0.6154 |             0.4444 |          1.0000 |     0.3077 |        0.0000 |
|   52.0000 |    2592.0000 |     63.0000 |     0.4286 |      0.6000 |             0.4286 |          1.0000 |     0.3000 |        0.0000 |
|   53.0000 |    2613.0000 |     63.0000 |     0.5714 |      0.4255 |             0.3571 |          0.5263 |     0.5419 |        0.1033 |
|   54.0000 |    2634.0000 |     63.0000 |     0.2063 |      0.3421 |             0.2063 |          1.0000 |     0.1711 |        0.0000 |
|   55.0000 |    2655.0000 |     63.0000 |     0.3175 |      0.3582 |             0.2182 |          1.0000 |     0.3147 |        0.0662 |
|   56.0000 |    2676.0000 |     63.0000 |     0.3333 |      0.4750 |             0.3585 |          0.7037 |     0.2810 |       -0.2149 |

## 8. 分类报告

```
              precision    recall  f1-score   support

       负例(0)       0.46      0.19      0.27      1897
       正例(1)       0.45      0.75      0.56      1694

    accuracy                           0.45      3591
   macro avg       0.45      0.47      0.42      3591
weighted avg       0.45      0.45      0.41      3591

```

## 9. 混淆矩阵

|       |   非涨(0) |   大涨(1) |
|:------|--------:|--------:|
| 非涨(0) |     360 |    1537 |
| 大涨(1) |     428 |    1266 |

## 10. Top 20 重要特征

| feature               |   importance |
|:----------------------|-------------:|
| price_vs_sma_50       |           33 |
| atr_pct_21            |           30 |
| sma_cross_50_200      |           22 |
| vol_volatility_20     |           16 |
| vol_price_corr_20     |           15 |
| vol_sma_10            |           15 |
| obv                   |           14 |
| open_interest_14      |           13 |
| cvd_ma_7              |           12 |
| sma_200               |           10 |
| trades_sma_20         |           10 |
| low_50d_dist          |            9 |
| low_21d_dist          |            9 |
| price_vs_vwap_10      |            9 |
| open_interest_7       |            9 |
| avg_trade_size_sma_20 |            9 |
| atr_21                |            8 |
| obv_sma_10            |            8 |
| cvd_ma_14             |            8 |
| price_vs_sma_200      |            7 |

## 附录: 完整配置

```yaml
experiment:
  name: weekly_bull_v7b
  description: 'Bull v7b 对照: 外部数据 + reversal 标签 (隔离外部数据贡献)'
  tags:
  - weekly
  - bull
  - binary
  - v7b
  - external
  - control
  category: weekly
data:
  source: binance
  symbol: BTCUSDT
  interval: 1d
  start: '2018-01-01'
  end: '2025-12-31'
  path: data/raw/btc_binance_BTCUSDT_1d.csv
features:
  sets:
  - technical
  - volume
  - flow
  - market_structure
  - external
  drop_na_method: ffill_then_drop
  scaling: null
label:
  strategy: reversal
  T: 14
  X: 0.05
  map:
    0: 0
    1: 0
    2: 1
model:
  type: lightgbm
  params:
    n_estimators: 1200
    max_depth: 5
    learning_rate: 0.03
    num_leaves: 24
    subsample: 0.8
    colsample_bytree: 0.7
    min_child_samples: 25
    reg_alpha: 0.2
    reg_lambda: 0.2
    random_state: 42
    verbose: -1
    min_split_gain: 0.005
    auto_scale_pos_weight: true
    early_stopping_rounds: 50
evaluation:
  method: walk_forward
  init_train: 1500
  oos_window: 63
  step: 21
  metrics:
  - accuracy
  - f1_binary
  - precision_binary
  - recall_binary
  - f1_macro
  - cohen_kappa
seed: 42

```